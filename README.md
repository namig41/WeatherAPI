# Проект Погода

`WeatherAPI` — это проект, предоставляющий простой и удобный REST API для работы с погодными данными, локациями и пользователями. Приложение позволяет добавлять, редактировать и просматривать информацию о локациях и пользователях, а также предоставляет базовые возможности авторизации.

### Для запуска приложения

1. **Клонируйте репозиторий:**

   ```bash
   git clone https://github.com/namig41/WeatherAPI.git
   cd WeatherAPI
   ```

2. Реализованные команды для сборки проекта

- `make all` — запустить приложение
- `make app` — запустить микросервисы авторизации и погоды
- `make app-logs` — отслеживать логи в контейнере приложения
- `make app-down` — остановить приложение
- `make shell` — открыть интерактивную оболочку (bash) внутри контейнера

## REST API

### API для работы с локациями

#### GET `/locations`

Получение всех локаций. Пример ответа:

```json
{
  "locations": [
    {
      "name": "East Patricia",
      "latitude": "84.8735595",
      "longitude": "84.8735595"
    },
    {
      "name": "Wendyville",
      "latitude": "27.0962525",
      "longitude": "27.0962525"
    },
    {
      "name": "East Danielhaven",
      "latitude": "-78.0894145",
      "longitude": "-78.0894145"
    },
    {
      "name": "Moscow",
      "latitude": "55.751244",
      "longitude": "55.751244"
    }
  ]
}
```

#### GET `/locations/{name}`

Получение локации по имени. Пример ответа:

```json
{
  "name": "Moscow",
  "latitude": "55.751244",
  "longitude": "55.751244"
}
```

HTTP-коды ответов:

- **200** — успешно
- **400** — код партии отсутствует в адресе
- **404** — локация не найдена

#### POST `/locations`

Добавление новой локации в базу. Данные передаются в теле запроса в виде JSON с полями `name`, `latitude` и `longitude`. Пример ответа:

```json
{
  "name": "Moscow",
  "latitude": "55.751244",
  "longitude": "55.751244"
}
```

HTTP-коды ответов:

- **200** — успешно
- **500** — ошибка (например, база данных недоступна)

### API для работы с пользователями

#### GET `/users`

Получение всех пользователей. Пример ответа:

```json
{
  "users": [
    {
      "login": "hardyluke",
      "email": "parrishjennifer@example.net",
      "password": "$5$rounds=535000$nuk5W9ZlYdbam0Cf$Ed2/LmObPb2mXxFNcf.7Gq/u1mxvLA/vnCE/WmFtpL3"
    },
    {
      "login": "burgessdaniel",
      "email": "kevinhobbs@example.org",
      "password": "$5$rounds=535000$MDAQW.L05j2wUDP4$xHHtw0PlZpRKz0rI6F/h/wrvbyso1GX1Vj4KBthoRL/"
    }
  ]
}
```

#### GET `/users/{login}`

Получение пользователя по логину. Пример ответа:

```json
{
    "login": "hardyluke",
    "email": "parrishjennifer@example.net",
    "password": "$5$rounds=535000$nuk5W9ZlYdbam0Cf$Ed2/LmObPb2mXxFNcf.7Gq/u1mxvLA/vnCE/WmFtpL3"
}
```

#### POST `/users`

Добавление нового пользователя в систему. Данные передаются в теле запроса в виде JSON с полями `login`, `email` и `password`. Пример ответа:

```json
{
    "login": "hardyluke",
    "email": "parrishjennifer@example.net",
    "password": "$5$rounds=535000$nuk5W9ZlYdbam0Cf$Ed2/LmObPb2mXxFNcf.7Gq/u1mxvLA/vnCE/WmFtpL3"
}
```

### **`GET /auth/login`**
Вход пользователя с помощью логина и пароля. В ответе содержится `access_token` в куки.

#### **HTTP-коды ответов:**
- **200** — Успешный вход.
- **400** — Неверный формат запроса (например, отсутствуют обязательные параметры `username` или `password`).
- **401** — Неверный логин или пароль.
- **403** — Аккаунт заблокирован или доступ запрещён.
- **500** — Ошибка сервера при обработке запроса.

---

### **`POST /auth/logout`**
Выход пользователя.

#### **HTTP-коды ответов:**
- **200** — Успешный выход.
- **401** — Пользователь не авторизован или токен истёк.
- **500** — Ошибка сервера при обработке запроса.

## **Зависимости**
### **Основные зависимости**
- **FastAPI** — Асинхронный веб-фреймворк.
- **SQLAlchemy** (с asyncio) — ORM для работы с базами данных.
- **Alembic** — Инструмент для миграции схем базы данных.
- **punq** — Библиотека для внедрения зависимостей.
- **pytest**: — Фреймворк для тестирования.

### **Аутентификация и безопасность**
- **jose**: — Библиотека для работы с JSON Web Token (JWT).
- **python-jose**: — Поддержка JWT и JWE для безопасности.
- **passlib**: — Библиотека для хэширования паролей.
- **pyjwt**: — Работа с токенами JWT.

### **Базы данных**
- **psycopg2**: — Адаптер для PostgreSQL.
- **asyncpg**: — Асинхронный драйвер для PostgreSQL.

### **Очереди задач и фоновые процессы**
- **celery** (с Redis) — Очередь задач для выполнения фоновых процессов.
- **aioredis**: — Асинхронный клиент для Redis.

### **Логирование и мониторинг**
- **structlog** — Конфигурируемое структурированное логирование.
- **flower** — Панель мониторинга для Celery.

### **Инструменты разработки**
- **pre-commit** — Инструмент для управления хуками pre-commit.
- **black** — Форматтер кода.
- **ipython** — Улучшенная интерактивная оболочка Python.
- **types-passlib** — Подсказки типов для passlib.
- **faker** — Генерация тестовых данных.

---

## **Инфраструктура**
### **Основные компоненты**
- **Postgres**: База данных для хранения данных.
- **RabbitMQ**: Система очередей для публикации событий.
- **Redis**: Используется как кэш и бэкенд для Celery.
- **Docker**: Контейнеризация для развёртывания.
